import { NextApiRequest, NextApiResponse } from 'next';
import { loadAllProblems } from '../../../../src/lib/loadContent';

export default async function handler(
    req: NextApiRequest,
    res: NextApiResponse
) {
    try {
        const { problems: allProblems } = await loadAllProblems();

        // Filter problems to only include USACO divisions
        const filteredProblems = allProblems.filter(problem =>
            problem.source && ['Bronze', 'Silver', 'Gold', 'Platinum'].includes(problem.source)
        );

        // Set cache headers for 1 hour
        res.setHeader('Cache-Control', 's-maxage=3600, stale-while-revalidate');
        res.status(200).json({ problems: filteredProblems });
    } catch (error) {
        console.error('Error in USACO divisions API:', error);
        res.status(500).json({ error: 'Failed to load USACO division problems' });
    }
}